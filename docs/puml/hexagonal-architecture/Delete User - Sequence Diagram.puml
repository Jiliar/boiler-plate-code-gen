@startuml DeleteUser
!theme plain
title Delete User - Hexagonal Architecture Flow

actor Client
participant "UserController\n(Input Adapter)" as Controller
participant "DeleteUserService\n(Application Layer)" as Service
participant "UserMapper\n(Application Layer)" as Mapper
participant "UserRepositoryAdapter\n(Output Adapter)" as RepoAdapter
participant "JpaUserRepository\n(Infrastructure)" as JpaRepo
database "H2 Database" as DB

Client -> Controller: DELETE /users/{userId}
activate Controller

Controller -> Service: execute(userId)
activate Service
note right: Implements DeleteUserUseCase\n(Domain Port)

Service -> RepoAdapter: findById(userId)
activate RepoAdapter
note right: Verify user exists\nbefore deletion

RepoAdapter -> JpaRepo: findById(userId)
activate JpaRepo
JpaRepo -> DB: SELECT * FROM users WHERE id = ?
DB --> JpaRepo: Optional<UserDbo>
JpaRepo --> RepoAdapter: Optional<UserDbo>
deactivate JpaRepo

alt User Found
    RepoAdapter -> Mapper: toDomain(UserDbo)
    activate Mapper
    Mapper --> RepoAdapter: User
    deactivate Mapper
    
    RepoAdapter --> Service: Optional<User>
    deactivate RepoAdapter
    
    Service -> RepoAdapter: deleteById(userId)
    activate RepoAdapter
    note right: Physical deletion\nfrom database
    
    RepoAdapter -> JpaRepo: deleteById(userId)
    activate JpaRepo
    JpaRepo -> DB: DELETE FROM users WHERE id = ?
    DB --> JpaRepo: void
    JpaRepo --> RepoAdapter: void
    deactivate JpaRepo
    
    RepoAdapter --> Service: void
    deactivate RepoAdapter
    
    Service -> Mapper: toDeleteResponse(userId)
    activate Mapper
    note right: Create success response\nwith deleted userId
    Mapper --> Service: DeleteUserResponseContent
    deactivate Mapper
    
    Service --> Controller: DeleteUserResponseContent
    deactivate Service
    
    Controller --> Client: HTTP 200\n{userId: "xxx", message: "User deleted successfully"}
    deactivate Controller

else User Not Found
    RepoAdapter --> Service: Optional.empty()
    deactivate RepoAdapter
    
    Service --> Controller: NotFoundException
    deactivate Service
    
    Controller --> Client: HTTP 404\n{error: "User not found"}
    deactivate Controller
end

@enduml